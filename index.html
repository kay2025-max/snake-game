<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ghuy Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('https://images.unsplash.com/photo-1600959907703-9c84efc539c6') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    .game-container, .menu-container {
      background: rgba(0, 0, 0, 0.85);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px #0f0;
      text-align: center;
      margin-bottom: 20px;
    }
    h2 { color: #0f0; margin-bottom: 20px; }
    button, select {
      background-color: #0f0;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    canvas {
      border: 4px solid #0f0;
      background-color: #111;
      box-shadow: 0 0 20px rgba(0,255,0,0.5);
    }
    #restartBtn, #menuBtn { display: none; }
  </style>
</head>
<body>
  <!-- Menu ch·ªçn map -->
  <div class="menu-container" id="menu">
    <h2>Ch·ªçn b·∫£n ƒë·ªì</h2>
    <select id="mapSelect">
      <option value="default">M·∫∑c ƒë·ªãnh</option>
      <option value="forest">R·ª´ng</option>
      <option value="desert">Sa m·∫°c</option>
      <option value="night">Ban ƒë√™m</option>
    </select><br />
    <button onclick="startGame()">B·∫Øt ƒë·∫ßu ch∆°i</button>
  </div>

  <!-- Game -->
  <div class="game-container" id="gameSection" style="display: none">
    <h2>üêç Ghuy Game üêç</h2>
    <canvas id="game" width="400" height="400"></canvas><br />
    <button id="restartBtn" onclick="restartGame()">Ch∆°i l·∫°i</button>
    <button id="menuBtn" onclick="returnToMenu()">Quay v·ªÅ menu</button>
  </div>

  <!-- √Çm thanh m·ªõi -->
  <audio id="eatSound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-casino-notification-211.wav" preload="auto"></audio>
  <audio id="gameOverSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-game-over-213.wav" preload="auto"></audio>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const restartBtn = document.getElementById("restartBtn");
    const menuBtn = document.getElementById("menuBtn");
    const eatSound = document.getElementById("eatSound");
    const gameOverSound = document.getElementById("gameOverSound");
    const menu = document.getElementById("menu");
    const gameDiv = document.getElementById("gameSection");
    const mapSelect = document.getElementById("mapSelect");

    let box = 20;
    let canvasSize = 400;
    let snake, direction, food, game, obstacles;

    const mapSettings = {
      default: { bg: "#111", obstacles: [] },
      forest: {
        bg: "#003300",
        obstacles: [
          { x: 5 * box, y: 5 * box },
          { x: 6 * box, y: 5 * box },
          { x: 7 * box, y: 5 * box },
          { x: 10 * box, y: 10 * box },
        ]
      },
      desert: {
        bg: "#CCAA66",
        obstacles: [
          { x: 8 * box, y: 2 * box },
          { x: 9 * box, y: 2 * box },
          { x: 10 * box, y: 2 * box },
          { x: 11 * box, y: 2 * box },
        ]
      },
      night: {
        bg: "#000022",
        obstacles: [
          { x: 3 * box, y: 12 * box },
          { x: 4 * box, y: 12 * box },
          { x: 5 * box, y: 12 * box },
        ]
      },
    };

    function startGame() {
      // K√≠ch √¢m thanh ƒë·ªÉ tr√¨nh duy·ªát cho ph√©p
      eatSound.play().catch(() => {});
      gameOverSound.play().catch(() => {});

      menu.style.display = 'none';
      gameDiv.style.display = 'block';
      initGame();
    }

    function initGame() {
      snake = [{ x: 9 * box, y: 9 * box }];
      direction = "RIGHT";
      const settings = mapSettings[mapSelect.value] || mapSettings.default;
      obstacles = settings.obstacles;
      ctx.canvas.style.backgroundColor = settings.bg;
      food = randomFood();
      restartBtn.style.display = "none";
      menuBtn.style.display = "none";
      if (game) clearInterval(game);
      game = setInterval(drawGame, 250); // t·ªëc ƒë·ªô ch·∫≠m
    }

    function randomFood() {
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * (canvasSize / box)) * box,
          y: Math.floor(Math.random() * (canvasSize / box)) * box
        };
      } while (
        snake.some(part => part.x === pos.x && part.y === pos.y) ||
        obstacles.some(ob => ob.x === pos.x && ob.y === pos.y)
      );
      return pos;
    }

    document.addEventListener("keydown", changeDirection);

    function changeDirection(e) {
      if (e.key === "ArrowLeft" && direction !== "RIGHT") direction = "LEFT";
      else if (e.key === "ArrowUp" && direction !== "DOWN") direction = "UP";
      else if (e.key === "ArrowRight" && direction !== "LEFT") direction = "RIGHT";
      else if (e.key === "ArrowDown" && direction !== "UP") direction = "DOWN";
    }

    function drawGame() {
      ctx.clearRect(0, 0, canvasSize, canvasSize);

      // V·∫Ω ch∆∞·ªõng ng·∫°i v·∫≠t
      ctx.fillStyle = "gray";
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, box, box);
      });

      // V·∫Ω r·∫Øn
      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = i === 0 ? "lime" : "green";
        ctx.fillRect(snake[i].x, snake[i].y, box, box);
        ctx.strokeStyle = "#003300";
        ctx.strokeRect(snake[i].x, snake[i].y, box, box);
      }

      // V·∫Ω th·ª©c ƒÉn
      ctx.fillStyle = "red";
      ctx.fillRect(food.x, food.y, box, box);

      // Di chuy·ªÉn
      let head = { x: snake[0].x, y: snake[0].y };
      if (direction === "LEFT") head.x -= box;
      if (direction === "UP") head.y -= box;
      if (direction === "RIGHT") head.x += box;
      if (direction === "DOWN") head.y += box;

      if (head.x === food.x && head.y === food.y) {
        eatSound.play();
        food = randomFood();
      } else {
        snake.pop();
      }

      // Va ch·∫°m t∆∞·ªùng, th√¢n, ch∆∞·ªõng ng·∫°i v·∫≠t
      if (
        head.x < 0 || head.y < 0 ||
        head.x >= canvasSize || head.y >= canvasSize ||
        snake.some(part => part.x === head.x && part.y === head.y) ||
        obstacles.some(ob => ob.x === head.x && ob.y === head.y)
      ) {
        clearInterval(game);
        gameOverSound.play();
        restartBtn.style.display = "inline-block";
        menuBtn.style.display = "inline-block";
        return;
      }

      snake.unshift(head);
    }

    function restartGame() {
      initGame();
    }

    function returnToMenu() {
      gameDiv.style.display = 'none';
      menu.style.display = 'block';
    }
  </script>
</body>
</html>
